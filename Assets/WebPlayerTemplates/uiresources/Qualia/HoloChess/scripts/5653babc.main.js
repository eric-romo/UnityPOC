"use strict";var engine=window.engine;$("#play-button").click(function(){console.log("Playing"),engine.call("Play")}),$("#new-game-button").click(function(){console.log("Starting new game"),engine.call("NewGame")});var startTime=Date.now(),clockInterval=setInterval(function(){var a=Date.now()-startTime,b=Math.floor(a/1e3),c=Math.floor(a/6e4),d=Math.floor(a%10);$("#clock").html(c+":"+b+":"+d)},20);!function(a){"object"==typeof module&&module.exports?module.exports=a(global,global.engine,!1):window.engine=a(window,window.engine,!0)}(function(global,engine,hasOnLoad){function Emitter(){this.events={}}function Handler(a,b){this.code=a,this.context=b}function callAsync(a,b,c){var d=function(){a.call(b,c)};setTimeout(d)}function Promise(){this.emitter=new Emitter,this.state=pending,this.result=null}function makeDefaultHandler(a){return function(){return a}}function createMethodStub(a){var b=function(){var b=Array.prototype.slice.call(arguments);return b.splice(0,0,a,this._id),engine.call.apply(engine,b)};return b}Emitter.prototype._createClear=function(a,b,c){return function(){var d=a.events[b];if(d){var e=d.indexOf(c);-1!=e&&(d.splice(e,1),0===d.length&&delete a.events[b])}}},Emitter.prototype.on=function(a,b,c){var d=this.events[a];void 0===d&&(d=this.events[a]=[]);var e=new Handler(b,c||this);return d.push(e),{clear:this._createClear(this,a,e)}},Emitter.prototype.off=function(a,b,c){var d=this.events[a];if(void 0!==d){c=c||this;var e,f=d.length;for(e=0;f>e;++e){var g=d[e];if(g.code==b&&g.context==c)break}f>e&&(d.splice(e,1),0===d.length&&delete this.events[a])}},Emitter.prototype.trigger=function(a){var b=this.events[a];if(void 0!==b){var c=Array.prototype.slice.call(arguments,1);b.forEach(function(a){a.code.apply(a.context,c)})}},Emitter.prototype.merge=function(a){var b,c=this.events,d=a.events,e=Array.prototype.push;for(var f in d)b=c[f]=c[f]||[],e.apply(b,d[f])};var pending="pending",fulfilled="fulfilled",broken="broken";Promise.prototype.resolve=function(a){this.state=fulfilled,this.result=a,this.emitter.trigger(fulfilled,a)},Promise.prototype.reject=function(a){this.state=broken,this.result=a,this.emitter.trigger(broken,a)},Promise.prototype.success=function(a,b){return this.state!==fulfilled?this.emitter.on(fulfilled,a,b):callAsync(a,b||this,this.result),this},Promise.prototype.always=function(a,b){return this.success(a,b),this.otherwise(a,b),this},Promise.prototype.otherwise=function(a,b){return this.state!==broken?this.emitter.on(broken,a,b):callAsync(a,b||this,this.result),this},Promise.prototype.merge=function(a){if(this.state===pending)this.emitter.merge(a.emitter);else{var b=a.emitter.events[this.state],c=this;void 0!==b&&b.forEach(function(a){a.code.call(a.context,c.result)})}},Promise.prototype.make_chain=function(a,b,c){return function(d){var e;try{e=a.code.call(a.context,d),e instanceof Promise?e.merge(b):this.state===c?b.resolve(e):b.reject(e)}catch(f){b.reject(f)}}},Promise.prototype.then=function(a,b){var c=new Promise,d=new Handler(a||makeDefaultHandler(this),this);this.success(this.make_chain(d,c,fulfilled),this);var e=new Handler(b||makeDefaultHandler(this),this);return this.otherwise(this.make_chain(e,c,broken),this),c};var simpleEvent=function(a){return function(){var b=["coherent-js",a],c=document.createElement("iframe");b.push.apply(b,arguments),c.src=b.join(":"),c.width="1px",c.height="1px",document.documentElement.appendChild(c),c.parentNode.removeChild(c)}};if(void 0===engine){if(void 0!==window.__couiAndroid&&void 0!==window.__couiAndroid.initCoui){var initRet=window.__couiAndroid.initCoui();initRet&&eval(initRet)}else simpleEvent("q")();engine=window.engine}var isAttached=void 0!==engine;engine=engine||{},engine.events={};for(var property in Emitter.prototype)engine[property]=Emitter.prototype[property];engine._trigger=Emitter.prototype.trigger;var concatArguments=Array.prototype.concat;if(engine.trigger=function(){if(this._trigger.apply(this,arguments),void 0!==this.events.all){var a=concatArguments.apply(["all"],arguments);this._trigger.apply(this,a)}},engine.IsAttached=isAttached,engine._BindingsReady=!1,engine._WindowLoaded=!1,engine._RequestId=0,engine._ActiveRequests={},engine.IsAttached){if(void 0===engine.SendMessage){var toArray=Array.prototype.slice;if(void 0==window.__couiAndroid){var _trigger=Emitter.prototype.trigger;engine._trigger=function(){var a=this,b=toArray.call(arguments,0),c=function(){_trigger.apply(a,b)};setTimeout(c)}}var frame=document.createElement("iframe"),createSendMessage=function(){var a="coherent-js:c:";return function(){var b=JSON.stringify(toArray.call(arguments,2));frame.src=a+arguments[0]+":"+arguments[1]+":"+encodeURIComponent(b),frame.width="1px",frame.height="1px",document.documentElement.appendChild(frame),frame.parentNode.removeChild(frame)}},createTriggerEvent=function(){var a="coherent-js:e:";return function(){var b=JSON.stringify(toArray.call(arguments,1));frame.src=a+arguments[0]+":"+encodeURIComponent(b),frame.width="1px",frame.height="1px",document.documentElement.appendChild(frame),frame.parentNode.removeChild(frame)}};engine.SendMessage=createSendMessage(),engine.TriggerEvent=createTriggerEvent();var ready=simpleEvent("r");engine.BindingsReady=function(){ready(0,window.location.href,window.parent===window?1:0)};var unload=simpleEvent("u"),unloadEvent=void 0===window.__couiAndroid?"unload":"beforeunload";window.addEventListener(unloadEvent,unload),engine.__observeLifetime=function(){}}}else engine.SendMessage=function(a,b){var c=Array.prototype.slice.call(arguments,2),d=engine._ActiveRequests[b];delete engine._ActiveRequests[b],c.push(d);var e=function(a,b){return function(){var c=engine["Mock_"+a];if(void 0!==c){var d=function(){c.apply(engine,b)};window.setTimeout(d,16)}}}(a,c);window.setTimeout(e,16)},engine.TriggerEvent=function(){var a,b=Array.prototype.slice.call(arguments);b[0]="Fake_"+b[0],a=function(a){return function(){engine.trigger.apply(engine,a)}}(b),window.setTimeout(a,16)},engine.BindingsReady=function(){engine._OnReady()},engine.__observeLifetime=function(){};if(engine.createDeferred=void 0===global.engineCreateDeferred?function(){return new Promise}:global.engineCreateDeferred,engine.call=function(){engine._RequestId++;var a=engine._RequestId,b=engine.createDeferred();engine._ActiveRequests[a]=b;var c=Array.prototype.slice.call(arguments);return c.splice(1,0,a),engine.SendMessage.apply(this,c),b},engine._Result=function(a){var b=engine._ActiveRequests[a];delete engine._ActiveRequests[a];var c=Array.prototype.slice.call(arguments);c.shift(),b.resolve.apply(b,c)},engine._Errors=["Success","ArgumentType","NoSuchMethod","NoResult"],engine._ForEachError=function(a,b){for(var c=a.length,d=0;c>d;++d)b(a[d].first,a[d].second)},engine._MapErrors=function(a){for(var b=a.length,c=0;b>c;++c)a[c].first=engine._Errors[a[c].first]},engine._TriggerError=function(a,b){engine.trigger("Error",a,b)},engine._OnError=function(a,b){if(engine._MapErrors(b),0===a)engine._ForEachError(b,engine._TriggerError);else{var c=engine._ActiveRequests[a];delete engine._ActiveRequests[a],c.reject(b)}},engine._eventHandles={},engine._Register=function(a){var b=function(a,b){return function(){var c=[a];c.push.apply(c,arguments),b.TriggerEvent.apply(this,c)}}(a,engine);engine._eventHandles[a]=engine.on(a,b)},engine._removeEventThunk=function(a){var b=engine._eventHandles[a];b.clear(),delete engine._eventHandles[a]},engine._Unregister=function(a){"string"==typeof a?engine._removeEventThunk(a):a.forEach(engine._removeEventThunk,engine)},engine._boundTypes={},engine._createInstance=function(a){var b=a[0],c=a[1],d=a[2],e=engine._boundTypes[b];void 0===e&&(e=function(a){this._id=a},e.prototype.__Type=b,d.forEach(function(a){e.prototype[a]=createMethodStub(b+"_"+a)}),engine._boundTypes[b]=e);var f=new e(c);return engine.__observeLifetime(f),f},engine._OnReady=function(){engine._BindingsReady=!0,engine._WindowLoaded&&engine.trigger("Ready")},engine._OnWindowLoaded=function(){engine._WindowLoaded=!0,engine._BindingsReady&&engine.trigger("Ready")},engine._hasClass=function(a,b){return(" "+a.className+" ").indexOf(" "+b+" ")>-1},engine.checkClickThrough=function(a,b){var c=document.elementFromPoint(a,b);if(c&&c!=document.body&&!engine._hasClass(c,"coui-noinput")){if(engine._hasClass(c,"coui-inputcallback")){var d=c.couiInputCallback(a,b);return d?"Y":"N"}return"Y"}return"N"},void 0!==window.__couiAndroid&&void 0!==window.__couiAndroid.addTouchEvent){var touchListener=function(a){return function(b){if(0!=window.__couiAndroid.inputState)if(1==window.__couiAndroid.inputState){b.preventDefault();for(var c=b.changedTouches,d=0;d<c.length;++d)window.__couiAndroid.addTouchEvent(Number(c[d].identifier),a,c[d].screenX,c[d].screenY)}else for(var c=b.changedTouches,d=0;d<c.length;++d){var e=engine&&engine.checkClickThrough&&engine.checkClickThrough(c[d].pageX,c[d].pageY);(0!=a||"N"==e)&&window.__couiAndroid.addTouchEvent(Number(c[d].identifier),a,c[d].screenX,c[d].screenY)}}},setupCoherentForAndroidFunc=function(){document.body.addEventListener("touchstart",touchListener(0)),document.body.addEventListener("touchend",touchListener(3)),document.body.addEventListener("touchcancel",touchListener(4)),document.body.addEventListener("touchmove",touchListener(1));var a=document.createElement("div");a.setAttribute("id","__CoherentBackground"),a.setAttribute("class","coui-noinput"),a.setAttribute("style",'background-color: "rgba(0,0,0,0)";width: 100%; height: 100%; position: absolute;z-index: -1000000;'),document.body.insertBefore(a,document.body.firstChild)};document.body?setupCoherentForAndroidFunc():document.addEventListener("DOMContentLoaded",setupCoherentForAndroidFunc)}return hasOnLoad?global.onload=function(a){return function(){a&&a(),engine._OnWindowLoaded()}}(global.onload):engine._WindowLoaded=!0,engine._coherentGlobalCanvas=document.createElement("canvas"),engine._coherentGlobalCanvas.id="coherentGlobalCanvas",engine._coherentGlobalCanvas.width=1,engine._coherentGlobalCanvas.height=1,engine._coherentGlobalCanvas.style.zIndex=0,engine._coherentGlobalCanvas.style.position="absolute",engine._coherentGlobalCanvas.style.border="0px solid",engine._coherentLiveImageData=new Array,engine._coherentCreateImageData=function(a,b){var c=engine._coherentGlobalCanvas.getContext("2d"),d=c.coherentCreateImageData(b);engine._coherentLiveImageData[a]=d},engine._coherentUpdatedImageData=function(a){engine._coherentLiveImageData[a].coherentUpdate();for(var b=document.getElementsByTagName("canvas"),c=0;c<b.length;++c)null!=b[c].onEngineImageDataUpdated&&b[c].onEngineImageDataUpdated(a,engine._coherentLiveImageData[a])},engine.on("_coherentCreateImageData",engine._coherentCreateImageData),engine.on("_coherentUpdatedImageData",engine._coherentUpdatedImageData),engine.on("_Result",engine._Result,engine),engine.on("_Register",engine._Register,engine),engine.on("_Unregister",engine._Unregister,engine),engine.on("_OnReady",engine._OnReady,engine),engine.on("_OnError",engine._OnError,engine),engine.BindingsReady(),engine});